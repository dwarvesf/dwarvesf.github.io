<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content><meta name=description property="og:description" content><meta name=keywords content><meta property="og:type" content="website"><meta property="og:url" content="https://note.d.foundation/playbook/engineering/error/"><meta property="og:image" content="https://note.d.foundation/img/LOGO.png"><link rel=icon type=image/x-icon href=https://note.d.foundation/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://note.d.foundation/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://note.d.foundation/favicon-32x32.png><link rel=apple-touch-icon href=https://note.d.foundation/apple-touch-icon.png><title>| Dwarves Foundation</title><meta name=description content><link rel=canonical href=https://note.d.foundation/playbook/engineering/error/><link rel="shortcut icon" type=image/png href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNk+A8AAQUBAScY42YAAAAASUVORK5CYII="><script defer data-domain=note.d.foundation src=https://plausible.io/js/script.js></script><style>:root{--primary-color:#e13F5e;--primary-font-color:#ddd;--primary-font-color-light:#333;--main-padding:4.5%;--column-gap:20px;--nav-sidebar-width:200px;--nav-sidebar-offset:0px}body{font-family:ibm plex sans,sans-serif;font-size:16px;color:#000;text-rendering:optimizeLegibility;padding:2rem;max-width:100%;margin:0;padding:0;background-color:#fff;line-height:1.5;min-height:100vh;display:flex;flex-direction:column;overflow-wrap:break-word;hyphens:auto}h1,h2,h3,h4{color:var(--primary-font-color)}h1{font-size:45px}h2{font-size:30px}h3{font-size:22px}h4{font-size:15px}q{font-size:20px;max-width:500px;display:block;margin-left:30px}pre{font-family:monospace;background:#000;color:#dadada;padding:15px;border-radius:2px;overflow-x:scroll;width:100%;box-sizing:border-box}pre>code{display:block;text-indent:0;white-space:inherit;font-weight:400}code{font-family:monospace;font-size:12px;background:#000;color:#dadada;padding:2px 5px;white-space:wrap;border-radius:2px;font-weight:700;display:inline-block;line-height:16px;overflow-x:scroll;margin-bottom:-4px}code comment{color:#777}code.button{background:#fff;color:#000;font-size:smaller;display:inline-block;padding:0 6px;font-weight:700;border-radius:2px;line-height:22px}a[href*="#"]{text-decoration:none}.note-title{display:inline-grid;width:100%;max-width:600px;grid-template-areas:"pagetitle pagetitle" "date tags" "authors authors";grid-template-rows:repeat(auto-fill,minmax(0,1fr));grid-template-columns:repeat(2,1fr)}.note-title .pagetitle{grid-area:pagetitle}.note-title .date{grid-area:date;color:#636466}.note-title .tags{grid-area:tags;justify-self:right}.note-title .authors{grid-area:authors}.grid{display:inline-grid;grid-template-areas:"title title title" "subtitle subtitle subtitle" "tabmenu tabmenu tabmenu" "nav content pagenav" "nav content pagenav";grid-template-rows:repeat(auto-fill,minmax(0,1fr));grid-template-columns:1fr 2fr 1fr;padding-bottom:48px}.grid>*{padding:16px 4.5%}.grid>h1{margin:0}.grid .title{grid-area:title;color:var(--primary-color)}.grid .subtitle{grid-area:subtitle;font-size:18px;padding-top:16px}.active{color:var(--primary-color);line-height:1.3;border-bottom:2px solid var(--primary-color)}nav.tab-menu{grid-area:tabmenu;border-bottom:1px solid #e7e7e7;padding-bottom:0}nav.tab-menu ul{list-style-type:none;padding:0;margin-bottom:0;display:inline-grid;width:100%;grid-template-rows:1fr;grid-template-columns:repeat(auto-fill,minmax(6rem,1fr));row-gap:16px}nav.tab-menu ul li{font-size:16px;font-weight:500;display:inline-block;margin-right:48px;padding:0 0 16px;width:min-content}nav.tab-menu ul li a{text-decoration:none;color:inherit}nav.menu{padding:24px 48px;line-height:22px;margin-top:-2px;white-space:nowrap;grid-area:nav}details{margin-left:-7px;overflow:hidden;font-size:14px;font-weight:500}.section-home{font-size:14px;font-weight:500;line-height:4}summary{padding:5px;display:block;padding-left:24px;position:relative;cursor:pointer}summary:before{content:'';border-width:.4rem;border-style:solid;border-color:transparent transparent transparent #000;position:absolute;top:10px;left:10px;transform:rotate(0);transform-origin:.2rem 50%;transition:.25s transform ease}details[open]>summary:before{transform:rotate(90deg)}details summary::-webkit-details-marker{display:none}details>ul{margin-bottom:0}hr{margin-left:0;width:100%;max-width:inherit}nav .site-nav{display:block}nav .site-nav section{margin-top:-2px}nav .site-nav section h2{margin:20px 0;font-size:24px;text-transform:lowercase}nav.menu ul{display:inline-grid;grid-template-rows:repeat(auto-fill,minmax(0,1fr));grid-template-columns:repeat(auto-fill,minmax(var(--nav-sidebar-width),1fr));padding:0 10px 10px 0;margin:0;list-style-type:none;line-height:22px}main{grid-area:content;display:inline-block;padding:var(--main-padding);width:700px;box-sizing:border-box;justify-self:center}main>ul{line-height:25px;margin:0}main>ul>li>a{text-decoration:underline}.dual-list>ul{columns:2}.single-list>ul{columns:2}.profile img{width:100px;height:100px;object-fit:cover;aspect-ratio:1/1}.profile object{width:100px;height:100px;object-fit:cover;aspect-ratio:1/1}table,th,td{border:1px solid;border-collapse:collapse;border-spacing:0}tr{max-height:100px;max-width:100px}td{padding:0 20px;max-width:300px;max-height:100px;overflow:hidden;text-overflow:ellipsis}td:has(img){padding:0;line-height:0}#TableOfContents>ul>li>a{text-decoration:underline}#TableOfContents>ul{display:grid;column-gap:var(--column-gap);box-sizing:border-box;grid-template-columns:repeat(auto-fill,minmax(0,calc(50% - var(--column-gap))));line-height:20px}#TableOfContents li{white-space:nowrap;list-style-type:decimal-leading-zero;list-style-position:inside;overflow:hidden;text-overflow:ellipsis}.notice{padding:20px;border:2px solid #000}main>blockquote{padding:20px;border:2px solid #000}main>*{max-width:inherit;margin-bottom:30px}header{padding:var(--main-padding);border-bottom:1px solid #363636}header h1{display:inline}footer{margin-top:auto;padding:var(--main-padding);clear:both}nav .site-nav ul li{list-style-type:none;display:flex;font-variant-numeric:tabular-nums;font-size:14px;padding-left:20px}li:has(input[type=checkbox]){display:block;list-style-type:none}ul:has(li input[type=checkbox]){padding:0}ul li a{overflow:hidden;text-overflow:ellipsis;background-color:#fff}ul li a:hover{white-space:nowrap;width:100%;z-index:10}ul li p{margin-block-end:0;margin-block-start:0}time{padding-right:1rem}blockquote{margin:1em 0;padding:0 2em;border-left:3px solid #eee}img{max-width:100%}video{max-width:100%}a,a:visited{color:#000}@media(prefers-color-scheme:dark){summary:before{border-color:transparent transparent transparent #fff}nav.tab-menu{border-bottom:1px solid #3d3d3d}a,a:visited{color:#dadada}body{background:#1e1e1e;color:#dadada}body a{color:#dadada}pre{background:#fff;color:#1e1e1e}code{background:#fff;color:#1e1e1e}body select{color:#000;background-color:#fff}.project{border-left:2px solid #fff}.notice{border-color:#fff}.mono{filter:invert(1)}.progress>div{background-color:#fff}.progress>div>span{color:#000}main>blockquote{border-color:#fff}ul li a{background-color:inherit}section>ul li a{background-color:inherit}}@media(prefers-color-scheme:light){h1,h2,h3,h4{color:var(--primary-font-color-light)}}@media only screen and (max-width:700px){main{width:100%}}@media only screen and (max-width:1100px){.grid{display:inline-grid;grid-template-areas:"title" "subtitle" "tabmenu" "content" "pagenav" "nav";grid-template-rows:repeat(auto-fill,minmax(0,1fr));grid-template-columns:1fr}.note-title{display:inline-grid;width:100%;grid-template-areas:"pagetitle" "date" "tags" "authors";grid-template-rows:repeat(auto-fill,minmax(0,1fr));grid-template-columns:1fr}.note-title .tags{justify-self:left}nav.menu ul{width:100%}nav.menu li{padding:8px}nav .site-nav section{margin:0 10px 10px 0}nav.menu{max-width:100%;box-sizing:border-box;display:inline-block}}</style><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"playbook","name":"","headline":"","alternativeHeadline":"","description":"Error Message Convention We use the following structure for our error message. It helps our system stay consistent, easier to present between components and also better for error tracking.\nTo make it easy to build informative error messages. To make errors easy to understand for users. To make errors helpful as diagnostics for programmers. Library Go: https:\/\/github.com\/dwarvesf\/gerr Elixir: https:\/\/github.com\/dwarvesf\/error.ex Swift: https:\/\/github.com\/dwarvesf\/error.swift Error Structure - type: list of common or pre-defined error type - message: error message - errors: actual error value in details - trace_id: Type of error We classify the error into some type:","inLanguage":"en-us","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/note.d.foundation\/playbook\/engineering\/error\/"},"author":{"@type":"Person","name":"Han Ngo"},"creator":{"@type":"Person","name":"Han Ngo"},"accountablePerson":{"@type":"Person","name":"Han Ngo"},"copyrightHolder":"Dwarves Foundation","copyrightYear":"0001","date":"0001-01-01T00:00:00.00Z","dateCreated":"0001-01-01T00:00:00.00Z","datePublished":"0001-01-01T00:00:00.00Z","dateModified":"0001-01-01T00:00:00.00Z","publisher":{"@type":"Organization","name":"Dwarves Foundation","url":"https://note.d.foundation/","logo":{"@type":"ImageObject","url":"https:\/\/note.d.foundation\/","width":"32","height":"32"}},"image":"https://note.d.foundation/","url":"https:\/\/note.d.foundation\/playbook\/engineering\/error\/","wordCount":"809","genre":[],"keywords":[]}</script><style>body{visibility:hidden;opacity:0}</style><noscript><style>body{visibility:visible;opacity:1}</style></noscript><script type=text/javascript>window.addEventListener("DOMContentLoaded",function(){document.body.style.visibility="visible",document.body.style.opacity=1})</script></head><body class=playbook><div class=grid><h1 class=title><a style=color:inherit;text-decoration:none href=/site-index>Dwarves Notes</a></h1><div class=subtitle>A collection of notes for everything we do and operate at Dwarves.</div><nav class=tab-menu><ul><li><a href=/>Home</a></li><li><a href=/earn>Earn</a></li><li><a href=/memo>Memo</a></li><li><a href=/radar>Radar</a></li><li><a href=/hiring>Hiring</a></li><li><a href=/newsletter>Newsletter</a></li></ul></details></nav><nav class=menu><section class=site-nav></section></nav><main><div class=note-title><h1 class=pagetitle></h1><div class=date>Jan 1, 0001</div><div class=tags>Tags:</div></div><hr><h1 id=error-message-convention><a href=#error-message-convention>Error Message Convention <a href=#error-message-convention></a></a></h1><p>We use the following structure for our error message. It helps our system stay consistent, easier to present between components and also better for error tracking.</p><ul><li>To make it easy to build informative error messages.</li><li>To make errors easy to understand for users.</li><li>To make errors helpful as diagnostics for programmers.</li></ul><h2 id=library><a href=#library>Library <a href=#library></a></a></h2><ul><li>Go: <a href=https://github.com/dwarvesf/gerr>https://github.com/dwarvesf/gerr</a></li><li>Elixir: <a href=https://github.com/dwarvesf/error.ex>https://github.com/dwarvesf/error.ex</a></li><li>Swift: <a href=https://github.com/dwarvesf/error.swift>https://github.com/dwarvesf/error.swift</a></li></ul><h2 id=error-structure><a href=#error-structure>Error Structure <a href=#error-structure></a></a></h2><pre><code>- type: list of common or pre-defined error type
- message: error message
- errors: actual error value in details
- trace_id: 
</code></pre><h2 id=type-of-error><a href=#type-of-error>Type of error <a href=#type-of-error></a></a></h2><p>We classify the error into some type:</p><ul><li>HTTP status error: <code>0 - 599</code></li><li>Internal error - occur inner system: <code>1000 - 10.000</code></li><li>Service error - occurs with other services that our system interacts: <code>10.000 - 20.000</code></li><li>Business error - occur when we process logic: <code>20.000 - ...</code></li></ul><p>We make some error handling packages for some languages, such as <code>golang</code>, <code>elixir</code>,&mldr; There are some set of common errors in our packages. We base on error code to detect the error for logging with level:</p><ul><li><code>Fatal</code>: level for panic server error. The error occurs inside the system. It makes our system is halted or down</li><li><code>Error</code>: an internal error, or service error. The error occurs when working with other services. It can make our system can be stuck</li><li><code>Warn</code>: business error, HTTP error. The error occurs in business logic. We just log it for debugging later</li><li><code>Debug</code>, <code>Info</code>: log some info or success data</li></ul><h2 id=constructing-an-error><a href=#constructing-an-error>Constructing an Error <a href=#constructing-an-error></a></a></h2><ul><li>Go</li></ul><pre><code class=language-go>// We defined some common error inside `gerr` package.
//
// We can reuse:
//   gerr.ErrSvcAuthRequired.Err()
// 
// There's some error type:
//  - Internal error: start from `InternalCodeCustom`
//  - Service error: start from `ServiceCodeCustom`
//  - Business error: start from `BusinessCodeCustom`
//
// init error code constant
const (
    ErrAttrInvalidCode = itoa + gerr.BusinessCodeCustom
    ErrAttrNotFoundCode
)

// init error variable
var (
    ErrAttrInvalid = gerr.New(ErrAttrInvalidCode, &quot;message error for attr&quot;)
)

// error usage
func handle(req Request) (*Response, error) {
    if res, err := processRequest(req); err != nil {
        return nil, ErrAttrInvalid.Err()
    }

    return res, nil
}
</code></pre><ul><li>Elixir</li></ul><pre><code class=language-elixir></code></pre><h2 id=errors-across-the-wire><a href=#errors-across-the-wire>Errors across the wire <a href=#errors-across-the-wire></a></a></h2><pre><code class=language-json>{
    &quot;message&quot;: &quot;client error message&quot;,
    &quot;trace_id&quot;: &quot;vldlCdkR3vAoupWkiENI&quot;,
    &quot;code&quot;: 4001,
    &quot;errors&quot;: {
        &quot;attribute_1&quot;: &quot;error message for attribute 1&quot;,
        &quot;items&quot;: {
            &quot;0&quot;: {
                &quot;attr1&quot;: &quot;error message for items[0].attr1&quot;
            },
            &quot;1&quot;: {
                &quot;attr2&quot;: &quot;error message for items[1].attr2&quot;
            }
        }
    }
}
</code></pre><ul><li>Logging:</li></ul><pre><code class=language-js>{ time=&quot;2020-10-08T12:10:57+07:00&quot;, level=&quot;error&quot;, env=&quot;dev&quot;, ip=&quot;115.73.208.232&quot;, method=&quot;POST&quot;, path=&quot;/orders&quot;, service=&quot;example-be&quot;, statusCode=&quot;500&quot;, traceId=&quot;vldlCdkR3vAoupWkiENI&quot;, userAgent=&quot;insomnia/2020.4.1&quot; }
Internal Server Error
 - at pkg/handler/order.go:34 (Handler.CreateOrder)
Trace: call service is failed
         - at pkg/handler/order.go:51 (Handler.doCreateOrder)
        Caused by: error message for items[0].attr1
         - at pkg/handler/order.go:60 (Handler.doValidateCreateOrder)
        Caused by: error message for items[1].attr2
         - at pkg/handler/order.go:70 (Handler.doValidateCreateOrder)
</code></pre><h2 id=matching-errors><a href=#matching-errors>Matching errors <a href=#matching-errors></a></a></h2><p>The errors contain a code. It&rsquo;s a number that makes a difference in many errors. We usually use the <code>code</code> number to match errors.</p><p>In Go, our package provides a utility function to match errors</p><pre><code class=language-go>func handler() {
    err := getProduct(1)

    if err != nil &amp;&amp; gerr.Match(err, errors.ErrNotFound) {
        // Do logic when err is ErrNotFound 
    }
}
</code></pre><h2 id=remote-error-tracking><a href=#remote-error-tracking>Remote Error Tracking <a href=#remote-error-tracking></a></a></h2><p>System log is like the airplane black box. When defects occur, along with steps used to reproduce from user report, the last thing we know is stored in the system log.</p><ul><li>We use <a href=sentry.io>Sentry</a> for both backend and frontend apps. Sentry helps collect and report the system log when errors occurred.</li><li>We use GLP stack as a remote logging service.</li></ul><p>Starting a new project, we usually set up and hook the error message to our project management system.</p><h2 id=replicating--handling-error><a href=#replicating--handling-error>Replicating & Handling error <a href=#replicating--handling-error></a></a></h2><p>To be able to reproduce an error you need to know what external actions lead to the error. To determine the cause of an error you need to know:</p><ul><li>The exact location in the code where the exception occurred.</li><li>The context in which that location in the code was reached. Some locations in your code are reachable via different execution paths. For instance, a utility method may be called from many different places in your application. You may need to know where the utility method was called from, in order to determine the cause of the exception.</li><li>A sensible description of the error including any relevant variable values, including parameters, internal state variables (members, global variables etc.) and possibly external system state, for instance data in a database.</li></ul><h4 id=environment-cloning><a href=#environment-cloning>Environment cloning <a href=#environment-cloning></a></a></h4><p>Every project should contain a method for replicating the state of one environment in another (e.g. copy prod to QA to reproduce an error). We structure our applications in a way that we could restore its snapshot at any point of time. A short command to replicate the context in which cause the error.</p><p>We develop strategies and tooling to help ease the debugging process.</p><ul><li>The sandbox env with related source code and data</li><li>Verify the steps used to produce the error</li><li>Verify the system/environment used to produce the error</li><li>Gather Screenshots and Logs</li><li>Gather step-by-step description from the user</li></ul></main></div></body></html>