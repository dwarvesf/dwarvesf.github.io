<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content><meta name=description property="og:description" content><meta name=keywords content><meta property="og:type" content="website"><meta property="og:url" content="https://note.d.foundation/playbook/engineering/ci-cd/"><meta property="og:image" content="https://note.d.foundation/img/LOGO.png"><link rel=icon type=image/x-icon href=https://note.d.foundation/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://note.d.foundation/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://note.d.foundation/favicon-32x32.png><link rel=apple-touch-icon href=https://note.d.foundation/apple-touch-icon.png><title>| Dwarves Foundation</title><meta name=description content><link rel=canonical href=https://note.d.foundation/playbook/engineering/ci-cd/><link rel="shortcut icon" type=image/png href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNk+A8AAQUBAScY42YAAAAASUVORK5CYII="><script defer data-domain=note.d.foundation src=https://plausible.io/js/script.js></script><style>:root{--primary-color:#e13F5e;--primary-font-color:#ddd;--primary-font-color-light:#333;--main-padding:48px;--column-gap:20px}body{font-family:ibm plex sans,sans-serif;font-size:16px;color:#000;text-rendering:optimizeLegibility;padding:2rem;max-width:100%;margin:0;padding:0;background-color:#fff;line-height:1.5;min-height:100vh;display:flex;flex-direction:column;overflow-wrap:break-word;hyphens:auto}h1,h2,h3,h4{color:var(--primary-font-color)}h1{font-size:45px}h2{font-size:30px}h3{font-size:22px}h4{font-size:15px}q{font-size:20px;max-width:500px;display:block;margin-left:30px}pre{font-family:monospace;background:#000;color:#dadada;padding:15px;border-radius:2px;overflow-x:scroll;width:100%;box-sizing:border-box}pre>code{display:block;text-indent:0;white-space:inherit;font-weight:400}code{font-family:monospace;font-size:12px;background:#000;color:#dadada;padding:2px 5px;white-space:wrap;border-radius:2px;font-weight:700;display:inline-block;line-height:16px;overflow-x:scroll;margin-bottom:-4px}code comment{color:#777}code.button{background:#fff;color:#000;font-size:smaller;display:inline-block;padding:0 6px;font-weight:700;border-radius:2px;line-height:22px}a[href*="#"]{text-decoration:none}.note-title{display:inline-grid;width:100%;max-width:600px;grid-template-areas:"pagetitle pagetitle" "date tags" "authors authors"}.note-title .pagetitle{grid-area:pagetitle}.note-title .date{grid-area:date;color:#636466}.note-title .tags{grid-area:tags;justify-self:right}.note-title .authors{grid-area:authors}.grid{display:inline-grid;grid-template-areas:"title title title" "subtitle subtitle subtitle" "tabmenu tabmenu tabmenu" "nav content pagenav" "nav content pagenav";grid-template-rows:100px 75px 60px 1fr 1fr;grid-template-columns:minmax(0,350px)2fr 1fr;padding-bottom:45px}.grid>*{padding:0 0 0 45px}.grid .title{grid-area:title;color:var(--primary-color)}.grid .subtitle{grid-area:subtitle;font-size:18px;padding-top:16px}.active{color:var(--primary-color);padding-bottom:17px;border-bottom:2px solid var(--primary-color)}nav.tab-menu{grid-area:tabmenu;border-bottom:1px solid #e7e7e7}nav.tab-menu ul{list-style-type:none;padding:0}nav.tab-menu ul li{font-size:16px;font-weight:500;display:inline-block;margin-right:45px}nav.tab-menu ul li a{text-decoration:none;color:inherit}nav.menu{padding:29px 0 0 45px;line-height:22px;margin-top:-2px;white-space:nowrap;grid-area:nav}details{margin-left:-7px;overflow:hidden;font-size:14px;font-weight:500}.section-home{font-size:14px;font-weight:500;line-height:4}summary{padding:5px;display:block;padding-left:24px;position:relative;cursor:pointer}summary:before{content:'';border-width:.4rem;border-style:solid;border-color:transparent transparent transparent #000;position:absolute;top:10px;left:10px;transform:rotate(0);transform-origin:.2rem 50%;transition:.25s transform ease}details[open]>summary:before{transform:rotate(90deg)}details summary::-webkit-details-marker{display:none}details>ul{margin-bottom:0}hr{margin-left:0;max-width:600px}nav .site-nav{display:block}nav .site-nav section{margin-top:-2px}nav .site-nav section h2{margin:20px 0;font-size:24px;text-transform:lowercase}nav.menu ul{padding:0 10px 10px 0;margin:0;list-style-type:none;line-height:22px}main{grid-area:content;padding:var(--main-padding);max-width:100%;box-sizing:border-box}main>ul{line-height:25px;margin:0}main>ul>li>a{text-decoration:underline}.dual-list>ul{columns:2}.single-list>ul{columns:2}.profile img{width:100px;height:100px;object-fit:cover;aspect-ratio:1/1}.profile object{width:100px;height:100px;object-fit:cover;aspect-ratio:1/1}table,th,td{border:1px solid;border-collapse:collapse;border-spacing:0}tr{max-height:100px;max-width:100px}td{padding:0 20px;max-width:300px;max-height:100px;overflow:hidden;text-overflow:ellipsis}td:has(img){padding:0;line-height:0}#TableOfContents>ul>li>a{text-decoration:underline}#TableOfContents>ul{display:grid;column-gap:var(--column-gap);box-sizing:border-box;grid-template-columns:repeat(auto-fill,minmax(var(--nav-sidebar-width),calc(50% - var(--column-gap))));line-height:20px}#TableOfContents li{white-space:nowrap;list-style-type:decimal-leading-zero;list-style-position:inside;overflow:hidden;text-overflow:ellipsis}.notice{padding:20px;border:2px solid #000}main>blockquote{padding:20px;border:2px solid #000}main>*{max-width:600px;margin-bottom:30px}header{padding:var(--main-padding);border-bottom:1px solid #363636}header h1{display:inline}footer{margin-top:auto;padding:var(--main-padding);clear:both}nav .site-nav ul li{list-style-type:none;display:flex;font-variant-numeric:tabular-nums;font-size:14px;padding-left:20px}li:has(input[type=checkbox]){display:block;list-style-type:none}ul:has(li input[type=checkbox]){padding:0}ul li a{overflow:hidden;text-overflow:ellipsis;width:calc(var(--nav-sidebar-width) + var(--nav-sidebar-offset));background-color:#fff}ul li a:hover{white-space:nowrap;width:100%;z-index:10}ul li p{margin-block-end:0;margin-block-start:0}time{padding-right:1rem}blockquote{margin:1em 0;padding:0 2em;border-left:3px solid #eee}img{max-width:100%}a,a:visited{color:#000}@media(prefers-color-scheme:dark){summary:before{border-color:transparent transparent transparent #fff}nav.tab-menu{border-bottom:1px solid #3d3d3d}a,a:visited{color:#dadada}body{background:#1e1e1e;color:#dadada}body a{color:#dadada}pre{background:#fff;color:#1e1e1e}code{background:#fff;color:#1e1e1e}body select{color:#000;background-color:#fff}.project{border-left:2px solid #fff}.notice{border-color:#fff}.mono{filter:invert(1)}.progress>div{background-color:#fff}.progress>div>span{color:#000}main>blockquote{border-color:#fff}ul li a{background-color:inherit}section>ul li a{background-color:inherit}}@media(prefers-color-scheme:light){h1,h2,h3,h4{color:var(--primary-font-color-light)}}@media only screen and (max-width:1100px){:root{--nav-sidebar-width:140px;--nav-sidebar-offset:0px}nav{width:100%}nav .site-nav section{margin:0 10px 10px 0}nav.menu{max-width:100%;box-sizing:border-box;display:inline-block}nav .site-nav{display:grid;column-gap:var(--column-gap);grid-template-columns:repeat(auto-fill,minmax(var(--nav-sidebar-width),1fr))}main{display:inline-block;width:unset}main>*{max-width:100%}ul li a{width:var(--nav-sidebar-width)}}</style><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"playbook","name":"","headline":"","alternativeHeadline":"","description":"Continuous Integration What Continuous Integration (CI) is a development practice where developers integrate code into a shared repository frequently, preferably several times a day. Each integration can then be verified by an automated build and automated tests. While automated testing is not strictly part of CI it is typically implied.\nOne of the key benefits of integrating regularly is that you can detect errors quickly and locate them more easily.","inLanguage":"en-us","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/note.d.foundation\/playbook\/engineering\/ci-cd\/"},"author":{"@type":"Person","name":"Han Ngo"},"creator":{"@type":"Person","name":"Han Ngo"},"accountablePerson":{"@type":"Person","name":"Han Ngo"},"copyrightHolder":"Dwarves Foundation","copyrightYear":"0001","date":"0001-01-01T00:00:00.00Z","dateCreated":"0001-01-01T00:00:00.00Z","datePublished":"0001-01-01T00:00:00.00Z","dateModified":"0001-01-01T00:00:00.00Z","publisher":{"@type":"Organization","name":"Dwarves Foundation","url":"https://note.d.foundation/","logo":{"@type":"ImageObject","url":"https:\/\/note.d.foundation\/","width":"32","height":"32"}},"image":"https://note.d.foundation/","url":"https:\/\/note.d.foundation\/playbook\/engineering\/ci-cd\/","wordCount":"936","genre":[],"keywords":[]}</script><style>body{visibility:hidden;opacity:0}</style><noscript><style>body{visibility:visible;opacity:1}</style></noscript><script type=text/javascript>window.addEventListener("DOMContentLoaded",function(){document.body.style.visibility="visible",document.body.style.opacity=1})</script></head><body class=playbook><div class=grid><h1 class=title><a style=color:inherit;text-decoration:none href=/site-index>Dwarves Notes</a></h1><div class=subtitle>A collection of notes for everything we do and operate at Dwarves.</div><nav class=tab-menu><ul><li><a href=/>Home</a></li><li><a href=/guild>Guild</a></li><li><a href=/memo>Memo</a></li><li><a href=https://brain.d.foundation/>Brainery</a></li><li><a href=/newsletter>Newsletter</a></li><li><a href=/site-index>Index</a></li></ul></details></nav><nav class=menu><section class=site-nav></section></nav><main><div class=note-title><h1 class=pagetitle></h1><div class=date>Jan 1, 0001</div><div class=tags>Tags:</div></div><hr><h1 id=continuous-integration><a href=#continuous-integration>Continuous Integration <a href=#continuous-integration></a></a></h1><h2 id=what><a href=#what>What <a href=#what></a></a></h2><p>Continuous Integration (CI) is a development practice where developers integrate code into a shared repository frequently, preferably several times a day. Each integration can then be verified by an automated build and automated tests. While automated testing is not strictly part of CI it is typically implied.</p><p>One of the key benefits of integrating regularly is that you can detect errors quickly and locate them more easily. As each change introduced is typically small, pinpointing the specific change that introduced a defect can be done quickly.</p><h2 id=importance-of-ci><a href=#importance-of-ci>Importance of CI <a href=#importance-of-ci></a></a></h2><p>In order to understand the importance of CI, it&rsquo;s helpful first to discuss some pain points that often arise due to the absence of CI. Without CI, developers must manually coordinate and communicate when they are contributing code to the end product. This coordination extends beyond the development teams to the rest of the organization, as well. Product teams must coordinate when to sequentially launch features and fixes and which team members will be responsible.</p><p>Without a robust CI pipeline, a disconnect between the engineering team and the rest of the org can form. Communication between product and engineering can be cumbersome. Engineering becomes a black box which the rest of the team inputs requirements and features and maybe gets expected results back. It will make it harder for engineering to estimate time of delivery on requests because the time to integrate new changes becomes an unknown risk.</p><h2 id=ci-at-dwarves><a href=#ci-at-dwarves>CI at Dwarves <a href=#ci-at-dwarves></a></a></h2><ul><li>Write tests, mostly integration: we don&rsquo;t do TDD, but we do write necessary unit tests, and lots of integration tests (because they ensure everything works as a whole), both kind of tests should be able to run on CI</li><li>Pull requests and code review: our CI system handles both individual commit pushs and PRs, in case of PRs - we create a separated deployment preview (for web apps), so everyone can visit and verify if everything works as intended</li><li>Optimize pipeline speed: Given that the CI pipeline is going to be a central and frequently used process, it is essential to optimize its execution speed. Any small delay in the CI workflow will compound exponentially as the rate of feature releases, team size, and codebase size grows. It is a best practice to measure the CI pipeline speed and optimize as necessary.<ul><li>customized Docker image: have a dedicated Docker image which includes prebuilding steps .eg migration tools and CLI binaries like <code>goose</code>, <code>psql</code>, <code>yarn</code>, <code>prettier</code></li><li>dependencies caching: cached go vendor or <code>node_modules</code> dir can significantly improve pipeline speed</li></ul></li><li>Collect build artifacts: can be helpful to re-verify previous builds manually</li></ul><h1 id=continuous-delivery><a href=#continuous-delivery>Continuous Delivery <a href=#continuous-delivery></a></a></h1><p>Continuous integration, deployment, and delivery are three phases of an automated software release pipeline. These three phases take software from idea to delivery to the end-user. The integration phase is the first step in the process. Integration covers the process of multiple developers attempting to merge their code changes with the master code repository of a project.</p><p>Development teams have seen enormous benefits from implementing continuous integration (CI) and continuous delivery (CD) as well as continuous deployment practices. By setting up a CI/CD pipeline, teams can merge small changes often, release code to production frequently, and feel confident doing so because any changes trigger a build that is tested automatically before being released.</p><h2 id=cd-at-dwarves><a href=#cd-at-dwarves>CD at Dwarves <a href=#cd-at-dwarves></a></a></h2><p>At Dwarves Foundation, achieving an efficient deployment pipeline is done by following these best practices:</p><ul><li>The process for releasing/deploying software MUST be repeatable and reliable</li><li>Automate everything - automate all the tasks you repeatedly do, and this tends to lead to reliability</li><li>Done means &ldquo;released.&rdquo;</li><li>Build quality comes first - take the time to invest in your quality metrics. A project with good, targeted quality metrics will invariably be better than one without, and easier to maintain in the long run</li><li>Tagging your builds and smoke test your deployments</li></ul><h1 id=setup-cicd-pipeline><a href=#setup-cicd-pipeline>Setup CI/CD pipeline <a href=#setup-cicd-pipeline></a></a></h1><ul><li>Pick your own CI platform: Gitlab CI, Circle CI or Bitrise for iOS</li><li>Write the CI instruction file: Most of the time the configuration file should be a YAML file; file structure should be different following your chosen CI platform.</li><li>There are a few stages that we need to specify: build, test, packaging, and push artifacts.</li><li>CI Server will trigger the target server to run the deployment script. Depends on the current setup, we may use Ansible or K8s to make it happen.</li><li>For mobile applications, the deployment may be varied. Some will use Fastlane to build and Fabric/Testflight for app distribution.</li></ul><h1 id=checklist><a href=#checklist>Checklist <a href=#checklist></a></a></h1><h2 id=ci><a href=#ci>CI <a href=#ci></a></a></h2><ul><li><input disabled type=checkbox> The pipeline covers test, build, packaging and push artifacts stage</li><li><input disabled type=checkbox> CI environment is cleaned from starting</li><li><input disabled type=checkbox> Pipeline is fast as possible</li><li><input disabled type=checkbox> Use cache (vendor, node_modules, &mldr;)</li><li><input disabled type=checkbox> Save artifacts after building stage</li><li><input disabled type=checkbox> Environment variables won&rsquo;t display when running CICD</li><li><input disabled type=checkbox> When building the app with docker, use alpine image</li><li><input disabled type=checkbox> When building the app with docker, the image should have tag:<ul><li>as <code>develop</code> for <code>develop</code> branch.</li><li>as <code>semantic versioning</code> when releasing tag and mark it as latest as well. For FE, you may need to build more than 1 version for a released tag e.g. v1.0.0-rc, v1.0.0-beta</li></ul></li><li><input disabled type=checkbox> For mobile, remember to write a script to have increase build number automatically</li><li><input disabled type=checkbox> The API target should be configured appropriately to reflect the current build environment. Avoiding pointing to different API version or environment.</li></ul><h2 id=cd><a href=#cd>CD <a href=#cd></a></a></h2><ul><li><input disabled type=checkbox> Make sure environment variables has been up-to-date after deploying</li><li><input disabled type=checkbox> Use image tag in different environments:<ul><li>develop use tag <code>develop</code></li><li>staging use tag <code>rc</code> or v1.0.0-rc (for FE)</li><li>production use <code>specific semantic tag</code> e.g. v1.0.0</li></ul></li><li><input disabled type=checkbox> Make sure the deployment has been shipped to correct environment (production, staging, &mldr;)</li><li><input disabled type=checkbox> For development environment, the database has been setup auto migrate after deploying new version</li></ul></main></div></body></html>